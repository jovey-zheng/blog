<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="hURnC-1VtFyi-v7OYQhy-5eOj-XZW3BAIs6iqzQcQj8" />










  <link href="/blog/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
	
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/blog/vendors/font-awesome/css/font-awesome.min.css?v=4.5.0" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.0.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="JavaScript,React,Testing,Tutorial,译文," />





  <link rel="alternate" href="/blog/atom.xml" title="Jovey's Notes" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/blog/favicon.ico?v=5.0.0" />






<meta name="description" content="测试是开发周期中的一个重要组成部分。没有测试的代码被称为：遗留代码。对于我而言，第一次学习 React 和 JavaScript 的时候，感到很有压力。如果你也是刚开始学习 JS/React，并加入他们的社区，那么也可能会有相同的感觉。想到的会是：

我应该用哪一个构建工具？
哪一个测试框架比较好？
我应该学习哪种流模式？
我需要用到流吗？

为了解决这些烦恼，我决定写这篇文章。经过几个小时的博客">
<meta property="og:type" content="article">
<meta property="og:title" content="React 测试驱动教程">
<meta property="og:url" content="http://jovey-zheng.github.io/blog/2016/01/21/article-17/index.html">
<meta property="og:site_name" content="Jovey's Notes">
<meta property="og:description" content="测试是开发周期中的一个重要组成部分。没有测试的代码被称为：遗留代码。对于我而言，第一次学习 React 和 JavaScript 的时候，感到很有压力。如果你也是刚开始学习 JS/React，并加入他们的社区，那么也可能会有相同的感觉。想到的会是：

我应该用哪一个构建工具？
哪一个测试框架比较好？
我应该学习哪种流模式？
我需要用到流吗？

为了解决这些烦恼，我决定写这篇文章。经过几个小时的博客">
<meta property="og:image" content="http://i.imgur.com/rYTjH77.png?1">
<meta property="og:updated_time" content="2017-06-14T12:53:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React 测试驱动教程">
<meta name="twitter:description" content="测试是开发周期中的一个重要组成部分。没有测试的代码被称为：遗留代码。对于我而言，第一次学习 React 和 JavaScript 的时候，感到很有压力。如果你也是刚开始学习 JS/React，并加入他们的社区，那么也可能会有相同的感觉。想到的会是：

我应该用哪一个构建工具？
哪一个测试框架比较好？
我应该学习哪种流模式？
我需要用到流吗？

为了解决这些烦恼，我决定写这篇文章。经过几个小时的博客">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: '[object Object]',
    fancybox: true,
    motion: true
  };
</script>

  <title> React 测试驱动教程 | Jovey's Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-67800719-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?7a046e8db6a48f2ab46b7812ba612789";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/blog/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Jovey's Notes</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">心有猛虎 细嗅蔷薇</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blog/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/blog/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
      
        <li class="menu-item menu-item-search">
          <a href="#" class="st-search-show-outputs">
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'Eq6Hisgzq2b_MSGwmySM','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                React 测试驱动教程
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-21T18:19:35+08:00" content="2016-01-21">
              2016-01-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/blog/categories/好文分享/" itemprop="url" rel="index">
                    <span itemprop="name">好文分享</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/blog/2016/01/21/article-17/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/21/article-17/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/blog/2016/01/21/article-17/"class="leancloud_visitors"  data-flag-title="React 测试驱动教程">
                &nbsp; | &nbsp;
                <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数</span>
               <span class="leancloud-visitors-count"></span>
            </span>
        
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>测试是开发周期中的一个重要组成部分。没有测试的代码被称为：遗留代码。对于我而言，第一次学习 React 和 JavaScript 的时候，感到很有压力。如果你也是刚开始学习 JS/React，并加入他们的社区，那么也可能会有相同的感觉。想到的会是：</p>
<ul>
<li>我应该用哪一个构建工具？</li>
<li>哪一个测试框架比较好？</li>
<li>我应该学习哪种流模式？</li>
<li>我需要用到流吗？</li>
</ul>
<p>为了解决这些烦恼，我决定写这篇文章。经过几个小时的博客文章阅读，查阅 JS 开发者的源码，还有参加 Florida 的 JSConf，终于让我找到了自己的测试“槽”。开始让我觉得没有经过测试的 React 程序代码是如此的不标准和凌乱。我想活在一个没有这种感觉的世界，但后来想想，这是不对的。</p>
<p>本教程所有的代码都可以在我的 <a href="https://github.com/SpencerCDixon/react-testing-starter-kit" target="_blank" rel="external">github 仓库</a>中找到。</p>
<p>让我们开始吧！</p>
<a id="more"></a>
<h2 id="设置-Webpack"><a href="#设置-Webpack" class="headerlink" title="设置 Webpack"></a>设置 Webpack</h2><p>本教程不是一个教如何使用 webpack，所以我不会详细说，但重要的是要了解基本的东西。<br>Webpack 就像 Rails 中的 Assets Pipeline 一样。在基础层面上而言，在运行 react 应用时，<br>会在处理你的代码和服务的前后，只生成一个 <code>bundle.js</code> 在客户端。</p>
<p>因为它是一个非常强大的工具，所以我们会常常用到。在开始，Webpack 的功能可能会吓到你，<br>但我建议你坚持使用下去，一旦你了解了其中的原理，就会觉得得心应手。而你只需给它一个机会去表现。</p>
<p>通常我们不会喜欢那些我们不会的，或是害怕的。然而，一旦你克服初始不适并开始理解它，总会变得很有趣。事实上，这正是我对测试的感受。当开始时讨厌它，在熟悉后喜欢它 :-)</p>
<p>如果感兴趣，这里有一些资源来更多地了解关于 webpack：</p>
<ol>
<li><a href="https://christianalfoni.github.io/react-webpack-cookbook/Getting-started.html" target="_blank" rel="external">Webpack Cookbook</a>（使用的是 Babel 5，但对于学习 Webpack 的基本原理而言还是很有用的）</li>
<li><a href="http://blog.madewithlove.be/post/webpack-your-bags/" target="_blank" rel="external">Webpack 初学者可以看这篇文章</a></li>
<li><a href="https://github.com/petehunt/webpack-howto" target="_blank" rel="external">Pete Hunts 所写的 Webpack How-to</a></li>
</ol>
<blockquote>
<p><strong>注意</strong>：如果要持续随本教程实验，建议使用 Node 版本为 <code>v5.1.0</code>。当然版本 <code>&gt;4</code> 的也是可以的。</p>
</blockquote>
<p>首先，安装所有关于 webpack 和 babel 的依赖。Babel 是一个转译器，允许你在开发时使用 ES6（es2015）和 ES7 的特性，然后将这些代码转译成浏览器可以识别的 ES5 代码。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> tdd_react</span><br><span class="line"><span class="keyword">cd</span> tdd_react</span><br><span class="line">npm init        # follow along with <span class="keyword">normal</span> npm init <span class="keyword">to</span> <span class="keyword">set</span> <span class="keyword">up</span> project</span><br><span class="line"></span><br><span class="line">npm <span class="keyword">i</span> babel-loader babel-core webpack --save-dev</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>npm i</code> 是 npm install 的别名。</p>
</blockquote>
<p>接下来，让我们设置项目的路径和创建一个 <code>webpack.config.js</code> 文件：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mkdir</span> src                  <span class="comment"># where all our source code will live</span></span><br><span class="line">touch src/main.js          <span class="comment"># this will be the entry point for our webpack bundling</span></span><br><span class="line"><span class="keyword">mkdir</span> test                 <span class="comment"># place to store all our tests</span></span><br><span class="line"><span class="keyword">mkdir</span> dist                 <span class="comment"># this is where the bundled javascript from webpack will go</span></span><br><span class="line">touch webpack.config.js    <span class="comment"># our webpack configuration file</span></span><br></pre></td></tr></table></figure>
<p>初始化的 webpack config 会很小。阅读这些注释，理解下发生了什么：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// our webpack.config.js file located in project root</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);                <span class="comment">// a useful node path helper library</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">  entry: [<span class="string">'./src/main.js'</span>],                <span class="comment">// the entry point for our app</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>), <span class="comment">// store the bundled output in dist/bundle.js</span></span><br><span class="line">    filename: <span class="string">'bundle.js'</span>                  <span class="comment">// specifying file name for our compiled assets</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="module"><span class="keyword">module</span>: </span>&#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      <span class="comment">// telling webpack which loaders we want to use.  For now just run the</span></span><br><span class="line">      <span class="comment">// code through the babel-loader.  'babel' is an alias for babel-loader</span></span><br><span class="line">      &#123; test: <span class="regexp">/\.js$/</span>, loaders: [<span class="string">'babel'</span>], exclude: <span class="regexp">/node_modules/</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports = config;</span></span><br></pre></td></tr></table></figure>
<p>为了让 babel 更好地工作，我们需要定义哪个 <code>presets</code> 是我们需要用到的。让我们继续，并且安装 React 和 ES6 预处理所需的东西：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">npm</span> i <span class="keyword">babel-preset-react </span><span class="keyword">babel-preset-es2015 </span>--save-dev</span><br></pre></td></tr></table></figure>
<p>现在我们有一些选项。在 webpack config 文件中，会告诉你哪一块是做 bebel 预处理的：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">loaders: [</span><br><span class="line">  &#123;</span><br><span class="line">    test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    loaders: [<span class="string">'babel'</span>],</span><br><span class="line">    <span class="keyword">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">    query: &#123;</span><br><span class="line">      presets: [<span class="string">'react'</span>, <span class="string">'es2015'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>另外的方法是将他们存在 <code>.babelrc</code> 文件中，这也用在我的项目中。将 babel 预处理存储在 <code>.babelrc</code> 中，对于以后的开发者而言，更容易去找到哪个 babel 预处理是可用的。此外，当我们将 Karma 设置到 webpack 之后，因为 <code>.babelrc</code> 文件的存在，我们就不再需要其他的预处理配置了。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inside our project root</span></span><br><span class="line"><span class="title">touch</span> .babelrc</span><br></pre></td></tr></table></figure>
<p>将下面这段粘贴到预处理文件中：</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [<span class="string">"react"</span>, <span class="string">"es2015"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了确认它能否工作，让我们在 <code>main.js</code> 中加入一些 react 代码，并看看所有的包是否正常。接着安装 React 和 React DOM：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="tag">i</span> react react-dom -S</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 <code>-S</code> 是 <code>--save</code> 的别名。</p>
</blockquote>
<p>创建第一个 React 组件：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># src/main.js</span><br><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; from <span class="symbol">'react</span>-dom';</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Root</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;h1&gt; <span class="type">Hello</span> <span class="type">World</span> &lt;/h1&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(&lt;<span class="type">Root</span> /&gt;, document.getElementById(<span class="symbol">'roo</span>t'));</span><br></pre></td></tr></table></figure>
<p>聪明的读者就会察觉我们并没有在根部创建一个 <code>index.html</code> 文件。让我们继续，当 <code>bundle.js</code> 编译后，将其放到 <code>/dist</code> 文件夹中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># /dist/index.html</span><br><span class="line"></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"root"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>非常棒，让我们继续。最后，我们可以运行 webpack，看看一切是否正常。如果你没有全局安装 webpack（<code>npm i webpack -g</code>），你也可以用 node modules 方式进行启动：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.<span class="regexp">/node_modules/</span>.bin/webpack</span><br></pre></td></tr></table></figure>
<p>Webpack 将默认情况下寻找一个配置名称为 <code>webpack.config.js</code>。如果你高兴，也可以通过不同 webpack config 作为参数传入。</p>
<p>在 package.json 中创建一个别名，来完成构建工作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># package.json</span></span><br><span class="line"><span class="prompt">... </span>other stuff</span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"webpack"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来让 <code>webpack-dev-server</code> 提升开发体验：</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-<span class="built_in">dev</span>-server --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<p>将 webpack dev server 的入口加入到 <code>webpack.config.js</code> 中：</p>
<figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">... rest <span class="keyword">of</span> config</span><br><span class="line">  entry: [</span><br><span class="line">    <span class="string">'webpack/hot/dev-server'</span>,</span><br><span class="line">    <span class="string">'webpack-dev-server/client?http://localhost:3000'</span>,</span><br><span class="line">    <span class="string">'./src/main.js'</span></span><br><span class="line">  ],</span><br><span class="line">... rest <span class="keyword">of</span> config</span><br></pre></td></tr></table></figure>
<p>让 script 运行在开发服务器上：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># package.json</span></span><br><span class="line">... other stuff</span><br><span class="line"><span class="label">scripts:</span> &#123;</span><br><span class="line">  <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --port 3000 --devtool eval --progress --colors --hot --content-base dist"</span>,</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"webpack"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 script 中使用了 <code>--content-base</code> 标记，告诉 webpack 我们想服务于 <code>/dist</code> 文件夹。我们还定义了 3000 端口，使得更像是 Rails 开发的体验。</p>
<p>最后，在 webpack 配置文件中添加一个 resolve 标记，使进口文件看起来更直观。下面就是配置文件最终的样子：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">  entry: [</span><br><span class="line">    <span class="string">'webpack/hot/dev-server'</span>,</span><br><span class="line">    <span class="string">'webpack-dev-server/client?http://localhost:3000'</span>,</span><br><span class="line">    <span class="string">'./src/main.js'</span></span><br><span class="line">  ],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    root: [</span><br><span class="line">      <span class="comment">// allows us to import modules as if /src was the root.</span></span><br><span class="line">      <span class="comment">// so I can do: import Comment from 'components/Comment'</span></span><br><span class="line">      <span class="comment">// instead of:  import Comment from '../components/Comment' or whatever relative path would be</span></span><br><span class="line">      path.resolve(__dirname, <span class="string">'./src'</span>)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// allows you to require without the .js at end of filenames</span></span><br><span class="line">    <span class="comment">// import Component from 'component' vs. import Component from 'component.js'</span></span><br><span class="line">    extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.jsx'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="module"><span class="keyword">module</span>: </span>&#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js?$/</span>,</span><br><span class="line">        <span class="comment">// dont run node_modules or bower_components through babel loader</span></span><br><span class="line">        exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">        <span class="comment">// babel is alias for babel-loader</span></span><br><span class="line">        <span class="comment">// npm i babel-core babel-loader --save-dev</span></span><br><span class="line">        loader: <span class="string">'babel'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="module"><span class="keyword">module</span>.exports = config;</span></span><br></pre></td></tr></table></figure>
<p>为确保一切工作正常，让我们运行开发服务器，并且确认我们在屏幕上看到 “Hello World”。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">run</span> dev</span><br><span class="line"><span class="keyword">open</span> http:<span class="comment">//localhost:3000</span></span><br></pre></td></tr></table></figure>
<p>你应该看到的是这样的：</p>
<p><img src="http://i.imgur.com/rYTjH77.png?1" alt="Hello World Image"></p>
<h2 id="设置-Mocha，Chai，Sinon-和-Enzyme"><a href="#设置-Mocha，Chai，Sinon-和-Enzyme" class="headerlink" title="设置 Mocha，Chai，Sinon 和 Enzyme"></a>设置 Mocha，Chai，Sinon 和 Enzyme</h2><p><strong>Mocha</strong>：将用于运行我们的测试。<br><strong>Chai</strong>：是我们期待的库。应用非常广泛，允许使用 RSpec 一样的语法。<br><strong>Sinon</strong>：将服务于 mocks/stubs/spies.<br><strong>Enzyme</strong>：将用于测试我们的 React components。AirBnB 写的一个很漂亮的测试库。</p>
<p>安装这些包：</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mocha chai sinon --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<p>如果我们希望能够使用 ES6 编写测试，那么我们需要在运行前对代码进行转译。那么我们需要安装 babel-register：</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-register --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<p>加一些 npm scripts 到 <code>package.json</code> 中，让测试更简单：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./package.json</span></span><br><span class="line">... <span class="property">rest</span> <span class="keyword">of</span> package.json</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"mocha --compilers js:babel-register --recursive"</span>,</span><br><span class="line">    <span class="string">"test:watch"</span>: <span class="string">"npm test -- --watch"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"webpack"</span>,</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"webpack-dev-server --port 3000 --devtool eval --progress --colors --hot --content-base dist"</span>,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>我们的测试脚本要运行 mocha，并使用 <code>babel-register</code> 进行转译，然后递归地查看 <code>/test</code> 目录。</p>
<p>最终，我们需要设置 Karma，因此 npm script 会变得无效，但如果不设置，它将会正常工作。<code>npm run test:watch</code> 将会监视程序，并在文件发生修改时重新运行。多么高效！</p>
<p>确认它能工作，创建一个 hello world 测试 <code>/tests/helloWorld.spec.js</code>：</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /test/helloWorld.spec.js</span></span><br><span class="line">import &#123; expect &#125; from <span class="string">'chai'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'hello world'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">'works!'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    expect(<span class="literal">true</span>).to.be.<span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>哇…看起来很像 RSpec！</p>
<p>如果每一个测试都要引入 <code>expect</code>，这将变得很麻烦，因此让我们新建一个 <code>test_helper</code> 文件来保存这些东西：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /test/test_helper.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; expect &#125; <span class="keyword">from</span> <span class="string">'chai'</span>;</span><br><span class="line"><span class="keyword">import</span> sinon <span class="keyword">from</span> <span class="string">'sinon'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">global</span>.expect = expect;</span><br><span class="line"><span class="built_in">global</span>.sinon = sinon;</span><br></pre></td></tr></table></figure>
<p>然后把它包括到 npm 脚本的运行套件中，并通过 <code>--require ./test/test_helper.js</code> 来声明：</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># package.json script section</span></span><br><span class="line">  <span class="string">"test"</span>: <span class="string">"mocha --compilers js:babel-register --require ./test/test_helper.js --recursive"</span>,</span><br></pre></td></tr></table></figure>
<p>我也添加了 sinon，因此它也可以全局可用。现在无论什么时候，我们在写一个新的测试时，都不需要手动引入 <code>expect</code> 和 <code>sinon</code>。</p>
<h3 id="Enzyme"><a href="#Enzyme" class="headerlink" title="Enzyme"></a>Enzyme</h3><p>现在我们所需的“普通”测试工具都已经设置好了（mocha，chai，sinon），接着让我们安装 Enzyme，并且开始测试 React component！</p>
<p>安装这个包：</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i enzyme react-addons-test-utils --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<p>Enzyme 的重要文档可以<a href="http://airbnb.io/enzyme/" target="_blank" rel="external">在这里找到</a>。如果有时间，我推荐阅读 Shallow Rendering 部分。</p>
<blockquote>
<p><strong>你会问，什么是 Shallow Rendering？</strong></p>
</blockquote>
<p>对我们来说是一种组件调用 render 方法，得到我们可以断言的 React 元素，而无需实际安装组件到 DOM 上。更多的 React 元素<a href="https://facebook.github.io/react/blog/2015/12/18/react-components-elements-and-instances.html" target="_blank" rel="external">请看这</a>。</p>
<p>Enzyme 会将 shallow rendered 组件包裹进一个特殊的 <code>wrapper</code> 中，进而让我们可以测试。如果你用过 Rails，这看起来像是 Capybara 中的 <code>page</code> 对象。</p>
<p>让我们为一些合适的 <code>&lt;Root /&gt;</code> 组件进行 TDD 的驱动开发。</p>
<p>这个 Root 组件会是一个 <code>container</code>，意味着在应用中它可以控制 state 的处理。学习 React 中“智能”和“笨拙”组件之间的差异，对于应用程序体系结构是很重要的。<a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.8cnl19w8l" target="_blank" rel="external">这篇文章很好地解释了它们</a>。</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /tests/containers/Root.spec.js</span></span><br><span class="line"></span><br><span class="line">import React from <span class="string">'react'</span>;                     <span class="regexp">//</span> required to get test to work.  we can get around <span class="keyword">this</span> later with more configuration</span><br><span class="line">import &#123; shallow &#125; from <span class="string">'enzyme'</span>;              <span class="regexp">//</span> method from enzyme which allows us to <span class="keyword">do</span> shallow render</span><br><span class="line">import Root from <span class="string">'../../src/containers/Root'</span>;  <span class="regexp">//</span> import our soon to be component</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'(Container) Root'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">'renders as a &lt;div&gt;'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    const wrapper = shallow(&lt;Root /&gt;);</span><br><span class="line">    expect(wrapper.type()).to.eql(<span class="string">'div'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'has style with height 100%'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    const wrapper = shallow(&lt;Root /&gt;);</span><br><span class="line">    const expectedStyles = &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="string">'100%'</span>,</span><br><span class="line">      <span class="attribute">background</span>: <span class="string">'#333'</span></span><br><span class="line">    &#125;</span><br><span class="line">    expect(wrapper.prop(<span class="string">'style'</span>)).to.eql(expectedStyles);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'contains a header explaining the app'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    const wrapper = shallow(&lt;Root /&gt;);</span><br><span class="line">    expect(wrapper.find(<span class="string">'.welcome-header'</span>)).to.have.length(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果我们用 <code>npm test</code> 运行测试，这会失败。因为我们没有在适当的位置创建一个根组件。因此我们可以这样做：</p>
<blockquote>
<p>如果在任何时候你想看到这段代码的源代码，可以在 <a href="https://github.com/SpencerCDixon/react-testing-starter-kit" target="_blank" rel="external">github 仓库</a> 中找到</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># /src/containers/<span class="type">Root</span>.js</span><br><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">const styles = &#123;</span><br><span class="line">  height: <span class="symbol">'100</span>%',</span><br><span class="line">  background: '#<span class="number">333</span>'</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Root</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div style=&#123;styles&#125;&gt;</span><br><span class="line">        &lt;h1 className=<span class="symbol">'welcome</span>-header'&gt;<span class="type">Welcome</span> to testing <span class="type">React</span>!&lt;/h1&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export <span class="keyword">default</span> <span class="type">Root</span>;</span><br></pre></td></tr></table></figure>
<p>重新运行测试就可以了。</p>
<p>在我们的测试中有很多重复的东西，因此我们还需要回去做一些重构。由于我们没有给 <code>Root</code> 传入任何的 props，那么我们可以 shallow render 它一次，然后就在一个 wrapper 中结束了我们所有的断言。很多时候给定一个特定的 props 后，我发现自己包装的部分测试会在 “sub” describe 块中，然后给一堆断言也有这些 props。如果你用过 RSpec，就类似于使用 “context” 块。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">describe<span class="list">(<span class="quoted">'(Container)</span> Root', <span class="list">()</span> =&gt; &#123;</span><br><span class="line">  const wrapper = shallow<span class="list">(<span class="keyword">&lt;Root</span> /&gt;)</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">  it<span class="list">(<span class="quoted">'renders</span> as a &lt;div&gt;', <span class="list">()</span> =&gt; &#123;</span><br><span class="line">    expect<span class="list">(<span class="keyword">wrapper</span>.type<span class="list">()</span>)</span>.to.eql<span class="list">(<span class="quoted">'div</span>')</span><span class="comment">;</span></span><br><span class="line">  &#125;)</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">  it<span class="list">(<span class="quoted">'has</span> style with height <span class="number">100</span>%', <span class="list">()</span> =&gt; &#123;</span><br><span class="line">    const expectedStyles = &#123;</span><br><span class="line">      height: '<span class="number">100</span>%',</span><br><span class="line">      background: <span class="quoted">'#333</span>'</span><br><span class="line">    &#125;</span><br><span class="line">    expect<span class="list">(<span class="keyword">wrapper</span>.prop<span class="list">(<span class="quoted">'style</span>')</span>)</span>.to.eql<span class="list">(<span class="keyword">expectedStyles</span>)</span><span class="comment">;</span></span><br><span class="line">  &#125;)</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">  it<span class="list">(<span class="quoted">'contains</span> a header explaining the app', <span class="list">()</span> =&gt; &#123;</span><br><span class="line">    expect<span class="list">(<span class="keyword">wrapper</span>.find<span class="list">('.welcome-header')</span>)</span>.to.have.length<span class="list">(<span class="number">1</span>)</span><span class="comment">;</span></span><br><span class="line">  &#125;)</span><span class="comment">;</span></span><br><span class="line">&#125;)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>尽可能地在你的测试中使用 <code>shallow</code>，但偶尔也可能不用。例如，如果你要测试 React 生命周期的方法时，就需要真正地将组件安装出来。</p>
<p>接下来让我们测试一个组件的安装和调用函数，当它安装时，我们可以得到一些暴露在 <code>sinon</code> 上的信息和正在使用的 spies。</p>
<p>我们可以假装 <code>Root</code> 组件有一个子组件叫 <code>CommentList</code>，在安装后将调用任意的回调。当通过给定 props 组件安装时，函数被调用，因此我们就可以测试这个场景。在组件渲染时给评论列表一些 style，然后我们就可以知道 shallow render 是如何处理这些样式的了。<code>CommentList</code> 会在一个组件文件夹的 <code>/src/components/CommentList.js</code> 中。因为它不处理数据，因此完全取决于 props，换句话说它是一个<strong>纯</strong>（<strong>笨拙</strong>）组件：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">import</span> React from <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Once we set up Karma to run our tests through webpack</span></span><br><span class="line"><span class="comment">// we will no longer need to have these long relative paths</span></span><br><span class="line"><span class="literal">import</span> CommentList from <span class="string">'../../src/components/CommentList'</span>;</span><br><span class="line"><span class="literal">import</span> &#123;</span><br><span class="line">  describeWithDOM,</span><br><span class="line">  mount,</span><br><span class="line">  shallow,</span><br><span class="line">  spyLifecycle</span><br><span class="line">&#125; from <span class="string">'enzyme'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'(Component) CommentList'</span>, () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// using special describeWithDOM helper that enzyme</span></span><br><span class="line">  <span class="comment">// provides so if other devs on my team don't have JSDom set up</span></span><br><span class="line">  <span class="comment">// properly or are using old version of node it won't bork their test suite</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// All of our tests that depend on mounting should go inside one of these</span></span><br><span class="line">  <span class="comment">// special describe blocks</span></span><br><span class="line">  describeWithDOM(<span class="string">'Lifecycle methods'</span>, () =&gt; &#123;</span><br><span class="line">    it(<span class="string">'calls componentDidMount'</span>, () =&gt; &#123;</span><br><span class="line">      spyLifecyle(CommentList);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> props = &#123;</span><br><span class="line">        onMount: () =&gt; &#123;&#125;,  <span class="comment">// an anonymous function in ES6 arrow syntax</span></span><br><span class="line">        isActive: <span class="keyword">false</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// using destructuring to pass props down</span></span><br><span class="line">      <span class="comment">// easily and then mounting the component</span></span><br><span class="line">      mount(&lt;CommentList &#123;...props&#125; /&gt;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// CommentList's componentDidMount should have been</span></span><br><span class="line">      <span class="comment">// called once.  spyLifecyle attaches sinon spys so we can</span></span><br><span class="line">      <span class="comment">// make this assertion</span></span><br><span class="line">      expect(</span><br><span class="line">        CommentList.prototype.componentDidMount.calledOnce</span><br><span class="line">      ).to.be.<span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'calls onMount prop once it mounts'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="comment">// create a spy for the onMount function</span></span><br><span class="line">      <span class="keyword">const</span> props = &#123; onMount: sinon.spy() &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// mount our component</span></span><br><span class="line">      mount(&lt;CommentList &#123;...props&#125; /&gt;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// expect that onMount was called</span></span><br><span class="line">      expect(props.onMount.calledOnce).to.be.<span class="keyword">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>还有很多，阅读这些注释可以帮助你更好地理解。看看这些实践，让测试可以通过，然后再回头看看这些测试，验证下你所理解的东西。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># /src/components/<span class="type">CommentList</span>.js</span><br><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span>, <span class="type">PropTypes</span> &#125; from <span class="symbol">'reac</span>t';</span><br><span class="line"></span><br><span class="line">const propTypes = &#123;</span><br><span class="line">  onMount: <span class="type">PropTypes</span>.func.isRequired,</span><br><span class="line">  isActive: <span class="type">PropTypes</span>.bool</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentList</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.onMount();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &lt;li&gt; <span class="type">Comment</span> <span class="type">One</span> &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">CommentList</span>.propTypes = propTypes;</span><br><span class="line">export <span class="keyword">default</span> <span class="type">CommentList</span>;</span><br></pre></td></tr></table></figure>
<p>运行 <code>npm test</code> ，现在这些套件应该可以通过测试了。</p>
<p>接下来让我们添加一些 shallow rendered 测试，当给定一个 <code>isActive</code> 的 props 时，来确保我们的组件使用了适当的 CSS class。</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">... previous tests</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'should render as a &lt;ul&gt;'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    const props = &#123; <span class="attribute">onMount</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125; &#125;;</span><br><span class="line">    const wrapper = shallow(&lt;CommentList  &#123;...props&#125; /&gt;);</span><br><span class="line">    expect(wrapper.type()).to.eql(<span class="string">'ul'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'when active...'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    const wrapper = shallow(</span><br><span class="line">      <span class="regexp">//</span> just passing isActive <span class="keyword">is</span> an alias <span class="keyword">for</span> <span class="literal">true</span></span><br><span class="line">      &lt;CommentList onMount=&#123;() =&gt; &#123;&#125;&#125; isActive /&gt;</span><br><span class="line">    )</span><br><span class="line">    it(<span class="string">'should render with className active-list'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      expect(wrapper.prop(<span class="string">'className'</span>)).to.eql(<span class="string">'active-list'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  describe(<span class="string">'when inactive...'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    const wrapper = shallow(</span><br><span class="line">      &lt;CommentList onMount=&#123;() =&gt; &#123;&#125;&#125; isActive=&#123;<span class="literal">false</span>&#125; /&gt;</span><br><span class="line">    )</span><br><span class="line">    it(<span class="string">'should render with className inactive-list'</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      expect(wrapper.prop(<span class="string">'className'</span>)).to.eql(<span class="string">'inactive-list'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>让它们通过测试：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentList</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Component</span> &#123;</span></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.onMount();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    const &#123; isActive &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    const className = isActive ? <span class="symbol">'active</span>-list' : <span class="symbol">'inactive</span>-list';</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul className=&#123;className&#125;&gt;</span><br><span class="line">        &lt;li&gt; <span class="type">Comment</span> <span class="type">One</span> &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时你应该对如何测试 react 组件已经有了一个很好的理解了。记得去阅读 Enzyme 文档来获得更多的灵感。</p>
<h2 id="设置-Karma"><a href="#设置-Karma" class="headerlink" title="设置 Karma"></a>设置 Karma</h2><p>设置 Karma 可能会有些困难。坦白讲，这对我而言也是一件痛苦的工作。通常，当我开发 React 应用时，我会选择使用已经构建好的 starter kit，方便省事。<a href="https://github.com/davezuko/react-redux-starter-kit" target="_blank" rel="external">我非常推荐开发时用的 starter kit</a>。</p>
<p>使用 Karma 的价值在于快速测试重载，可以多浏览器测试和最重要的是 webpack 预处理。一旦我们将 Karma 设置好了，在我们运行测试程序时，不仅是只有 <code>babel-loader</code>，而是整个 webpack config。这为我们提供了很多便利，使得我们的测试环境与开发环境相同。</p>
<p>让我们开始吧…</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm i karma karma-chai karma-mocha karma-webpack <span class="comment">--save-dev</span></span><br><span class="line">npm i karma-sourcemap-loader karma-phantomjs-launcher <span class="comment">--save-dev</span></span><br><span class="line">npm i karma-spec-reporter <span class="comment">--save-dev</span></span><br><span class="line">npm i phantomjs <span class="comment">--save-dev</span></span><br><span class="line"></span><br><span class="line"># The polyfills arn't required but will <span class="operator"><span class="keyword">help</span> <span class="keyword">with</span> browser support issues</span><br><span class="line"># <span class="keyword">and</span> <span class="keyword">are</span> easy enough <span class="keyword">to</span> <span class="keyword">include</span> <span class="keyword">in</span> our karma config that <span class="keyword">I</span> figured why <span class="keyword">not</span></span><br><span class="line">npm <span class="keyword">i</span> babel-polyfill phantomjs-polyfill <span class="comment">--save-dev</span></span></span><br></pre></td></tr></table></figure>
<p>很多包，我知道。相信我完成这个是非常值得的。</p>
<p>对于我们的示例而言，我们将使用 <a href="http://phantomjs.org/" target="_blank" rel="external">PhantomJS</a>。没有别的什么原因，这我在 starter kit 中已经用到了。可以按照自己的喜好使用 Chrome，Firefox 或是 Safari，甚至在 PhantomJS 之上。（这是用 Karma 的一件很酷的事）</p>
<p>在配置 karma 之前先安装 <code>yargs</code>，它能让你使用命令行参数来定制 Karma 的配置。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="tag">i</span> yargs -S</span><br></pre></td></tr></table></figure>
<p>现在我们可以通过创建一个 Karma config 文件去监视我们的文件，当文件发生修改时重新运行并很快地保存。</p>
<p><strong>Karma Config</strong>：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch karma<span class="class">.config</span><span class="class">.js</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./karma.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> argv = <span class="built_in">require</span>(<span class="string">'yargs'</span>).argv;</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config.set(&#123;</span><br><span class="line">    <span class="comment">// only use PhantomJS for our 'test' browser</span></span><br><span class="line">    browsers: [<span class="string">'PhantomJS'</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// just run once by default unless --watch flag is passed</span></span><br><span class="line">    singleRun: !argv.watch,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// which karma frameworks do we want integrated</span></span><br><span class="line">    frameworks: [<span class="string">'mocha'</span>, <span class="string">'chai'</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// displays tests in a nice readable format</span></span><br><span class="line">    reporters: [<span class="string">'spec'</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// include some polyfills for babel and phantomjs</span></span><br><span class="line">    files: [</span><br><span class="line">      <span class="string">'node_modules/babel-polyfill/dist/polyfill.js'</span>,</span><br><span class="line">      <span class="string">'./node_modules/phantomjs-polyfill/bind-polyfill.js'</span>,</span><br><span class="line">      <span class="string">'./test/**/*.js'</span> <span class="comment">// specify files to watch for tests</span></span><br><span class="line">    ],</span><br><span class="line">    preprocessors: &#123;</span><br><span class="line">      <span class="comment">// these files we want to be precompiled with webpack</span></span><br><span class="line">      <span class="comment">// also run tests throug sourcemap for easier debugging</span></span><br><span class="line">      [<span class="string">'./test/**/*.js'</span>]: [<span class="string">'webpack'</span>, <span class="string">'sourcemap'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// A lot of people will reuse the same webpack config that they use</span></span><br><span class="line">    <span class="comment">// in development for karma but remove any production plugins like UglifyJS etc.</span></span><br><span class="line">    <span class="comment">// I chose to just re-write the config so readers can see what it needs to have</span></span><br><span class="line">    webpack: &#123;</span><br><span class="line">       devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">       resolve: &#123;</span><br><span class="line">        <span class="comment">// allow us to import components in tests like:</span></span><br><span class="line">        <span class="comment">// import Example from 'components/Example';</span></span><br><span class="line">        root: path.resolve(__dirname, <span class="string">'./src'</span>),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// allow us to avoid including extension name</span></span><br><span class="line">        extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.jsx'</span>],</span><br><span class="line"></span><br><span class="line">        <span class="comment">// required for enzyme to work properly</span></span><br><span class="line">        alias: &#123;</span><br><span class="line">          <span class="string">'sinon'</span>: <span class="string">'sinon/pkg/sinon'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="built_in">module</span>: &#123;</span><br><span class="line">        <span class="comment">// don't run babel-loader through the sinon module</span></span><br><span class="line">        noParse: [</span><br><span class="line">          <span class="regexp">/node_modules\/sinon\//</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="comment">// run babel loader for our tests</span></span><br><span class="line">        loaders: [</span><br><span class="line">          &#123; test: <span class="regexp">/\.js?$/</span>, exclude: <span class="regexp">/node_modules/</span>, loader: <span class="string">'babel'</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// required for enzyme to work properly</span></span><br><span class="line">      externals: &#123;</span><br><span class="line">        <span class="string">'jsdom'</span>: <span class="string">'window'</span>,</span><br><span class="line">        <span class="string">'cheerio'</span>: <span class="string">'window'</span>,</span><br><span class="line">        <span class="string">'react/lib/ExecutionEnvironment'</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">'react/lib/ReactContext'</span>: <span class="string">'window'</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    webpackMiddleware: &#123;</span><br><span class="line">      noInfo: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// tell karma all the plugins we're going to be using to prevent warnings</span></span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="string">'karma-mocha'</span>,</span><br><span class="line">      <span class="string">'karma-chai'</span>,</span><br><span class="line">      <span class="string">'karma-webpack'</span>,</span><br><span class="line">      <span class="string">'karma-phantomjs-launcher'</span>,</span><br><span class="line">      <span class="string">'karma-spec-reporter'</span>,</span><br><span class="line">      <span class="string">'karma-sourcemap-loader'</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>阅读所有的注释一次或两次有助于理解这个 config 是做什么的。使用 Webpack 的一大好处是全部都是普通的 JavaScript 代码，并且我们可以“重构”配置文件。事实上，这正是绝大多数 starter kit 所做的！</p>
<p>随着 Karma 设置完成，为运行测试，最后一件事就是要去更新我们的 package.json：</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># package.json</span></span><br><span class="line">  <span class="string">"scripts"</span> &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"node_modules/.bin/karma start karma.config.js"</span>,</span><br><span class="line">    <span class="string">"test:dev"</span>: <span class="string">"npm run test -- --watch"</span>,</span><br><span class="line">    <span class="string">"old_test"</span>: <span class="string">"mocha --compilers js:babel-register --require ./test/test_helper.js --recursive"</span>,</span><br><span class="line">    <span class="string">"old_test:watch"</span>: <span class="string">"npm test -- --watch"</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>我建议重命名旧的测试 scripts 的前缀，用 ‘old_’ 表示。</p>
<p>最终的 <code>package.json</code> 是这样的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"react-testing-starter-kit"</span></span>,</span><br><span class="line">  "<span class="attribute">version</span>": <span class="value"><span class="string">"0.1.0"</span></span>,</span><br><span class="line">  "<span class="attribute">description</span>": <span class="value"><span class="string">"React starter kit with nice testing environment set up."</span></span>,</span><br><span class="line">  "<span class="attribute">main</span>": <span class="value"><span class="string">"src/main.js"</span></span>,</span><br><span class="line">  "<span class="attribute">directories</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"tests"</span></span>,</span><br><span class="line">    "<span class="attribute">src</span>": <span class="value"><span class="string">"src"</span></span>,</span><br><span class="line">    "<span class="attribute">dist</span>": <span class="value"><span class="string">"dist"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">dependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">react</span>": <span class="value"><span class="string">"^0.14.6"</span></span>,</span><br><span class="line">    "<span class="attribute">react-dom</span>": <span class="value"><span class="string">"^0.14.6"</span></span>,</span><br><span class="line">    "<span class="attribute">yargs</span>": <span class="value"><span class="string">"^3.31.0"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">devDependencies</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">babel-core</span>": <span class="value"><span class="string">"^6.4.0"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-loader</span>": <span class="value"><span class="string">"^6.2.1"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-polyfill</span>": <span class="value"><span class="string">"^6.3.14"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-preset-es2015</span>": <span class="value"><span class="string">"^6.3.13"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-preset-react</span>": <span class="value"><span class="string">"^6.3.13"</span></span>,</span><br><span class="line">    "<span class="attribute">babel-register</span>": <span class="value"><span class="string">"^6.3.13"</span></span>,</span><br><span class="line">    "<span class="attribute">chai</span>": <span class="value"><span class="string">"^3.4.1"</span></span>,</span><br><span class="line">    "<span class="attribute">enzyme</span>": <span class="value"><span class="string">"^1.2.0"</span></span>,</span><br><span class="line">    "<span class="attribute">json-loader</span>": <span class="value"><span class="string">"^0.5.4"</span></span>,</span><br><span class="line">    "<span class="attribute">karma</span>": <span class="value"><span class="string">"^0.13.19"</span></span>,</span><br><span class="line">    "<span class="attribute">karma-chai</span>": <span class="value"><span class="string">"^0.1.0"</span></span>,</span><br><span class="line">    "<span class="attribute">karma-mocha</span>": <span class="value"><span class="string">"^0.2.1"</span></span>,</span><br><span class="line">    "<span class="attribute">karma-phantomjs-launcher</span>": <span class="value"><span class="string">"^0.2.3"</span></span>,</span><br><span class="line">    "<span class="attribute">karma-sourcemap-loader</span>": <span class="value"><span class="string">"^0.3.6"</span></span>,</span><br><span class="line">    "<span class="attribute">karma-spec-reporter</span>": <span class="value"><span class="string">"0.0.23"</span></span>,</span><br><span class="line">    "<span class="attribute">karma-webpack</span>": <span class="value"><span class="string">"^1.7.0"</span></span>,</span><br><span class="line">    "<span class="attribute">mocha</span>": <span class="value"><span class="string">"^2.3.4"</span></span>,</span><br><span class="line">    "<span class="attribute">phantomjs</span>": <span class="value"><span class="string">"^1.9.19"</span></span>,</span><br><span class="line">    "<span class="attribute">phantomjs-polyfill</span>": <span class="value"><span class="string">"0.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">react-addons-test-utils</span>": <span class="value"><span class="string">"^0.14.6"</span></span>,</span><br><span class="line">    "<span class="attribute">sinon</span>": <span class="value"><span class="string">"^1.17.2"</span></span>,</span><br><span class="line">    "<span class="attribute">webpack</span>": <span class="value"><span class="string">"^1.12.11"</span></span>,</span><br><span class="line">    "<span class="attribute">webpack-dev-server</span>": <span class="value"><span class="string">"^1.14.1"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">scripts</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">test</span>": <span class="value"><span class="string">"node_modules/.bin/karma start karma.config.js"</span></span>,</span><br><span class="line">    "<span class="attribute">test:dev</span>": <span class="value"><span class="string">"npm run test -- --watch"</span></span>,</span><br><span class="line">    "<span class="attribute">build</span>": <span class="value"><span class="string">"webpack"</span></span>,</span><br><span class="line">    "<span class="attribute">dev</span>": <span class="value"><span class="string">"webpack-dev-server --port 3000 --devtool eval --progress --colors --hot --content-base dist"</span></span>,</span><br><span class="line">    "<span class="attribute">old_test</span>": <span class="value"><span class="string">"mocha --compilers js:babel-register --require ./test/test_helper.js --recursive"</span></span>,</span><br><span class="line">    "<span class="attribute">old_test:watch</span>": <span class="value"><span class="string">"npm test -- --watch"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">repository</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">type</span>": <span class="value"><span class="string">"git"</span></span>,</span><br><span class="line">    "<span class="attribute">url</span>": <span class="value"><span class="string">"tbd"</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line">  "<span class="attribute">author</span>": <span class="value"><span class="string">"Spencer Dixon"</span></span>,</span><br><span class="line">  "<span class="attribute">license</span>": <span class="value"><span class="string">"ISC"</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>在测试套件中外加 webpack 预处理，我们现在可以删除那些在测试内烦人的相对路径声明：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test/containers/Root.spec.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br><span class="line"><span class="keyword">import</span> Root <span class="keyword">from</span> <span class="string">'containers/Root'</span>;               <span class="comment">// new import statement</span></span><br><span class="line"><span class="comment">// import Root from '../../src/containers/Root';  // old import statement</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test/components/CommentList.spec.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> CommentList <span class="keyword">from</span> <span class="string">'components/CommentList'</span>;               <span class="comment">// new import statement</span></span><br><span class="line"><span class="comment">// import CommentList from '../../src/components/CommentList';  // old import statement</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  describeWithDOM,</span><br><span class="line">  mount,</span><br><span class="line">  shallow,</span><br><span class="line">  spyLifecycle</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'enzyme'</span>;</span><br></pre></td></tr></table></figure>
<p>现在使用这个 starter kit 开发，你需要输入以下这些命令去运行程序：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">run</span> dev         # <span class="keyword">note</span> the addition of <span class="keyword">run</span></span><br><span class="line">npm <span class="keyword">run</span> <span class="keyword">test</span>:dev    # <span class="keyword">note</span> the addition of <span class="keyword">run</span></span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/SpencerCDixon/react-testing-starter-kit" target="_blank" rel="external">如果还有什么不清楚的地方，可以在 github 上查看该源码</a>。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>我们已经建立了一个坚实的测试环境，可以根据你的项目具体需求去改变和发展。在下一次的文章中，我将花更多的时间在特殊场景的测试，还有如何测试 Redux，我更喜欢 flux 的实现。</p>
<p>虽然我只使用 React 开发了数月，但我已经爱上它了。我希望本教程可以帮助你更深入地理解一些 React 测试的最佳实践。有任何问题或评论随时联系我。测试是我们的好朋友！</p>
<p><a href="http://spencerdixon.com/blog/test-driven-react-tutorial.html?utm_campaign=Front%2BEnd%2BNewsletter&amp;utm_medium=email&amp;utm_source=Front_End_Newsletter_2" target="_blank" rel="external"><strong>原文链接</strong></a></p>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/blog/tags/JavaScript/" rel="tag">#JavaScript</a>
          
            <a href="/blog/tags/React/" rel="tag">#React</a>
          
            <a href="/blog/tags/Testing/" rel="tag">#Testing</a>
          
            <a href="/blog/tags/Tutorial/" rel="tag">#Tutorial</a>
          
            <a href="/blog/tags/译文/" rel="tag">#译文</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2015/12/24/article-16/" rel="next" title="20 个交互非常棒的按钮代码">
                <i class="fa fa-chevron-left"></i> 20 个交互非常棒的按钮代码
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/2016/01/26/article-18/" rel="prev" title="React 入门实践">
                React 入门实践 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/01/21/article-17/"
           data-title="React 测试驱动教程" data-url="http://jovey-zheng.github.io/blog/2016/01/21/article-17/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/blog/images/default_avatar.jpg"
               alt="Jovey Zheng" />
          <p class="site-author-name" itemprop="name">Jovey Zheng</p>
          <p class="site-description motion-element" itemprop="description">Front End | Nodejs | React | Redux ...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/blog/archives">
              <span class="site-state-item-count">20</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/blog/categories">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/blog/tags">
              <span class="site-state-item-count">47</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/blog/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jovey-zheng" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/1633564683" target="_blank">
                  
                    <i class="fa fa-weibo"></i> Weibo
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/profile.php?id=100010207239121" target="_blank">
                  
                    <i class="fa fa-facebook-square"></i> Facebook
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/9de90a2d9205/latest_articles" target="_blank">
                  
                    <i class="fa fa-heartbeat"></i> JianShu
                  
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/blog/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#设置-Webpack"><span class="nav-number">1.</span> <span class="nav-text">设置 Webpack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置-Mocha，Chai，Sinon-和-Enzyme"><span class="nav-number">2.</span> <span class="nav-text">设置 Mocha，Chai，Sinon 和 Enzyme</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enzyme"><span class="nav-number">2.1.</span> <span class="nav-text">Enzyme</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置-Karma"><span class="nav-number">3.</span> <span class="nav-text">设置 Karma</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#结论"><span class="nav-number">3.1.</span> <span class="nav-text">结论</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-leaf"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jovey Zheng</span>
</div>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/blog/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/blog/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/blog/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/blog/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/blog/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/blog/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.0.0"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.0.0"></script>



  
  


  <script type="text/javascript" src="/blog/js/src/affix.js?v=5.0.0"></script>

  <script type="text/javascript" src="/blog/js/src/schemes/pisces.js?v=5.0.0"></script>



  
  
<script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.0.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    motionMiddleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');
      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.0.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"joveyzheng"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      <script type="text/javascript">
        var duoshuo_user_ID = 13537963;
        var duoshuo_admin_nickname = "博主";
      </script>
      <script src="/blog/vendors/ua-parser-js/dist/ua-parser.min.js"></script>
      <script src="/blog/js/src/hook-duoshuo.js"></script>
    
  





  
  

  
  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("KIpFhjbOqk9B6NsU6sEACyJt", "HOFTbHJmJyGsoGKssFSPrPAy");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>




  
  <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery-lazyload/1.9.5/jquery.lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/blog/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>

</body>
</html>
